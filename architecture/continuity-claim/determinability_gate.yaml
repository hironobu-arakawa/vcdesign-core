# determinability_gate.yaml
# IDG â€” Interface Determinability Gate
#
# Purpose:
#   Determine whether a judgment is allowed to be promoted to "Resolution"
#   within the current boundary, based on explicit determinability conditions.
#
# Non-goals:
#   - Do not propose solutions
#   - Do not optimize outcomes
#   - Do not assign responsibility
#   - Do not silently auto-resolve ambiguity

idg:
  name: "Interface Determinability Gate"
  short_name: "IDG"
  version: "0.1.0"
  status: "draft"

  intent:
    description: >
      IDG is a gate that evaluates whether a judgment may be considered
      determinable within the current interface/boundary.
      IDG does not decide. It only classifies determinability and
      provides reasons and required evidence.
    non_goals:
      - propose_solution
      - decide_for_humans
      - automate_responsibility
      - hide_ambiguity
      - optimize_outcomes

  # ---- Core classification ----
  determinability:
    # Allowed classification values are intentionally small and stable.
    classes:
      - DETERMINABLE
      - INDETERMINABLE
      - UNKNOWN

    # If UNKNOWN, treat as INDETERMINABLE by default in downstream control.
    default_downstream_policy:
      unknown_treated_as: "INDETERMINABLE"

  # ---- Inputs (Fact vs Hypothesis separation) ----
  input_contract:
    # Facts must be auditable and referenceable.
    facts:
      required:
        - fact_bundle_id
        - sources
        - observed_at
      fields:
        fact_bundle_id: { type: "string", note: "Stable ID for the fact set" }
        observed_at: { type: "string", format: "date-time" }
        sources:
          type: "array"
          items:
            type: "object"
            fields:
              source_type: { type: "string", enum: ["sensor", "log", "doc", "human_report", "other"] }
              source_ref: { type: "string", note: "URI / path / record id" }
              integrity:  { type: "string", enum: ["verified", "unverified", "unknown"] }

    # Hypotheses may exist but must not be promoted by IDG.
    hypotheses:
      allowed: true
      note: >
        Hypotheses can be attached as context, but IDG does not validate them
        as truth. IDG only checks whether determinability conditions are met.

    # Requested judgment is the "question" or "decision candidate",
    # not the answer.
    judgment_request:
      required:
        - request_id
        - scope
        - boundary_id
        - purpose
      fields:
        request_id: { type: "string" }
        scope: { type: "string", note: "What is being judged (NOT the decision)" }
        boundary_id: { type: "string", note: "Which boundary/interface is attempting to judge" }
        purpose: { type: "string", note: "Why this judgment is needed" }

  # ---- Gate rules (must be explicit; no hidden checks) ----
  gate_rules:
    # Each rule declares:
    #  - what evidence is required
    #  - what failure means
    #  - whether failure makes judgment INDETERMINABLE or UNKNOWN
    #
    # Keep these stable and minimal. Add domain-specific rules in binding.
    rules:
      - rule_id: "IDG-FACT-INTEGRITY"
        title: "Facts are referenceable and integrity-known"
        required_evidence:
          - "facts.sources[*].source_ref"
          - "facts.sources[*].integrity"
        failure_classification: "INDETERMINABLE"
        rationale: >
          If facts cannot be referenced or integrity is unknown/unverified
          for critical sources, determinability cannot be claimed.

      - rule_id: "IDG-SCOPE-BOUNDARY-DECLARED"
        title: "Scope and boundary are explicitly declared"
        required_evidence:
          - "judgment_request.scope"
          - "judgment_request.boundary_id"
        failure_classification: "UNKNOWN"
        rationale: >
          Without an explicit boundary/interface, the gate cannot know
          what determinability standard applies.

      - rule_id: "IDG-PURPOSE-DECLARED"
        title: "Purpose is declared"
        required_evidence:
          - "judgment_request.purpose"
        failure_classification: "UNKNOWN"
        rationale: >
          Determinability depends on purpose (what responsibility would follow).

      - rule_id: "IDG-TRACEABILITY-MINIMUM"
        title: "Minimum trace fields exist for later audit"
        required_evidence:
          - "facts.fact_bundle_id"
          - "judgment_request.request_id"
          - "facts.observed_at"
        failure_classification: "INDETERMINABLE"
        rationale: >
          If minimal trace cannot be ensured, claiming determinability
          is unsafe even if the judgment seems obvious.

    # Domain-specific determinability criteria should be expressed in binding.
    binding_extension_policy:
      allowed: true
      must_not:
        - "weaken_core_rules"
        - "auto_promote_resolution"
        - "hide_failure_reasons"

  # ---- Output contract (what downstream uses) ----
  output_contract:
    result:
      required:
        - request_id
        - classification
        - reasons
        - required_actions
      fields:
        request_id: { type: "string" }
        classification: { type: "string", enum: ["DETERMINABLE", "INDETERMINABLE", "UNKNOWN"] }
        reasons:
          type: "array"
          items:
            type: "object"
            fields:
              rule_id: { type: "string" }
              status:  { type: "string", enum: ["PASS", "FAIL", "SKIP"] }
              note:    { type: "string" }

        # Actions are NOT solutions. They are what must be provided/clarified
        # before determinability can be re-evaluated.
        required_actions:
          type: "array"
          items:
            type: "object"
            fields:
              action_type: { type: "string", enum: ["provide_fact", "clarify_boundary", "clarify_purpose", "collect_evidence", "handoff_to_human"] }
              description: { type: "string" }
              owner_hint:   { type: "string", note: "Optional: who could perform it" }

    # Optional standardized downstream routing hints.
    downstream_hints:
      enabled: true
      note: >
        Routing is not IDG's responsibility. These are hints only.
      mapping:
        DETERMINABLE:
          recommended_next: "eligible_for_resolution_elevation"
        INDETERMINABLE:
          recommended_next: "invoke_rp_or_human_handoff"
        UNKNOWN:
          recommended_next: "treat_as_indeterminable_and_handoff"

  # ---- Audit / invariants ----
  invariants:
    - "IDG never emits a solution or decision content"
    - "IDG always emits explicit pass/fail reasons per evaluated rule"
    - "UNKNOWN must not be used to silently proceed"
    - "If classification != DETERMINABLE, downstream must not elevate to Resolution"

  todos:
    - "Define boundary_id taxonomy and binding mechanism"
    - "Define what constitutes 'critical sources' for FACT-INTEGRITY in each domain"
    - "Define integration interface with RP (handoff packet shape) in boa binding"

# ---- Evidence schemas (normative references) ----
evidence_schemas:
  note: >
    These schemas define acceptable evidence shapes for IDG evaluation.
    They must not change pass/block judgment semantics by themselves.
  refs:
    - path: "/patterns/idg/schemas/operation_log_min.yaml"
      id: "operation_log_min"
      role: "minimal operation log evidence"

# ---- Profiles (non-normative domain/interface mappings) ----
profiles:
  note: >
    Profiles provide domain vocabulary and interface-kind mappings.
    They MUST NOT change the determinability decision by themselves.
    They exist to standardize "what is interface-bounded" per domain.
  refs:
    - path: "/patterns/idg/profiles/analytics_llm.yaml"
      id: "analytics_llm"
    - path: "/patterns/idg/profiles/enterprise_decision.yaml"
      id: "enterprise_decision"
    - path: "/patterns/idg/profiles/factory.yaml"
      id: "factory"
    - path: "/patterns/idg/profiles/finance.yaml"
      id: "finance"
    - path: "/patterns/idg/profiles/healthcare.yaml"
      id: "healthcare"
    - path: "/patterns/idg/profiles/legal.yaml"
      id: "legal"
    - path: "/patterns/idg/profiles/personal_ai.yaml"
      id: "personal_ai"
    - path: "/patterns/idg/profiles/public_sector.yaml"
      id: "public_sector"
